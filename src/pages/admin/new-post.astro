---
import AdminLayout from "../../layouts/AdminLayout.astro";
---

<AdminLayout title="Add Post" Description="Add a new post to the blog">
  <section class="form-container">
    <div class="form-card">
      <h2 class="form-title">Add Post</h2>
      <form method="post">
        <label for="title">Title</label>
        <input
          type="text"
          id="title"
          name="title"
          placeholder="Enter the post title"
          required
        />

        <div class="hero-img-display">
          <label>Current Image:</label>

          <!-- Container de imagem e input de arquivo -->
          <div class="image-container">
            <img
              id="imagePreview"
              src="/public/blog-placeholder-about.jpg"
              alt="Current Image"
              onclick="document.getElementById('heroImg').click();"
            />
            <input type="file" id="heroImg" name="heroImg" accept="image/*" />
          </div>
        </div>

        <label for="content">Content</label>
        <textarea
          id="content"
          name="content"
          placeholder="Enter the post content"
          required></textarea>

        <button type="submit" class="btn-submit">Add Post</button>
      </form>
    </div>
  </section>

  <style>
    input[type="file"] {
      display: none; /* Oculta o input real */
    }
    .image-container {
      position: relative;
    }
    img {
      width: 300px;
      height: 200px;
      object-fit: cover;
      object-position: center;
      display: block;
      cursor: pointer;
    }
  </style>

  <script>
    // Seleção dos elementos do DOM com tipos específicos
    const heroImgInput = document.getElementById(
      "heroImg"
    ) as HTMLInputElement | null;
    const imagePreview = document.getElementById(
      "imagePreview"
    ) as HTMLImageElement | null;

    // Checando se os elementos existem antes de adicionar o eventListener
    if (heroImgInput && imagePreview) {
      heroImgInput.addEventListener("change", (event: Event) => {
        const input = event.target as HTMLInputElement;
        const file = input.files ? input.files[0] : null;

        if (file) {
          const reader = new FileReader();

          reader.onload = (e: ProgressEvent<FileReader>) => {
            if (e.target) {
              imagePreview.src = e.target.result as string;
              imagePreview.style.display = "block";
            }
          };

          reader.readAsDataURL(file);
        }
      });
    }
  </script>
</AdminLayout>
